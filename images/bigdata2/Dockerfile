FROM ubuntu:20.04 as intermediate
ENV DEBIAN_FRONTEND="noninteractive"
WORKDIR /src
COPY data .
RUN /src/install_hadoop.sh bigdata2-primary
RUN /src/install_spark.sh



FROM openjdk:11

ENV DEBIAN_FRONTEND="noninteractive"

COPY --from=intermediate /spark /spark
COPY --from=intermediate /hadoop /hadoop

RUN apt update
RUN apt install ssh pdsh vim -yq

ENV PATH="$PATH:/spark/bin:/hadoop/bin"
ENV HADOOP_HOME="/hadoop"
ENV SPARK_HOME="/spark"

WORKDIR /app
COPY src .

EXPOSE 0
EXPOSE 2181
EXPOSE 7077
EXPOSE 8030
EXPOSE 8031
EXPOSE 8032
EXPOSE 8033
EXPOSE 8040
EXPOSE 8042
EXPOSE 8044
EXPOSE 8045
EXPOSE 8046
EXPOSE 8047
EXPOSE 8048
EXPOSE 8049
EXPOSE 8080
EXPOSE 8088
EXPOSE 8089
EXPOSE 8090
EXPOSE 8091
EXPOSE 8111
EXPOSE 8188
EXPOSE 8190
EXPOSE 8480
EXPOSE 8481
EXPOSE 8485
EXPOSE 8788
EXPOSE 8888
EXPOSE 9000
EXPOSE 9046
EXPOSE 9864
EXPOSE 9865
EXPOSE 9866
EXPOSE 9867
EXPOSE 9868
EXPOSE 9869
EXPOSE 9870
EXPOSE 9871
EXPOSE 10020
EXPOSE 10033
EXPOSE 10200
EXPOSE 19888
EXPOSE 19890
EXPOSE 50030
EXPOSE 50060
EXPOSE 50070
EXPOSE 50071
EXPOSE 50072
EXPOSE 50075
EXPOSE 50100
EXPOSE 50105
EXPOSE 50200

CMD ["/app/start.sh"]
